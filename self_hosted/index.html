<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.11.0.813803834060">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.11.0">

    <!-- Primary Meta Tags -->
    <title>Stack de self-host</title>
    <meta name="title" content="Stack de self-host">
    <meta name="description" content="wireguard: VPN">

    <!-- Canonical -->
    <link rel="canonical" href="/self_hosted/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="/self_hosted/">
    <meta property="og:title" content="Stack de self-host">
    <meta property="og:description" content="wireguard: VPN">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="/self_hosted/">
    <meta property="twitter:title" content="Stack de self-host">
    <meta property="twitter:description" content="wireguard: VPN">

    <script data-cfasync="false">(function(){var cl=document.documentElement.classList,ls=localStorage.getItem("retype_scheme"),hd=cl.contains("dark"),hl=cl.contains("light"),wm=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(ls==="dark"||(!ls&&wm&&!hd&&!hl)){cl.remove("light");cl.add("dark")}else if(ls==="light"||(!ls&&!wm&&!hd&&!hl)){cl.remove("dark");cl.add("light")}})();</script>

    <link href="../static/nuclea-logo.png" rel="icon">
    <link href="../resources/css/retype.css?v=3.11.0.813803834060" rel="stylesheet">

    <script data-cfasync="false" src="../resources/js/config.js?v=3.11.0.813803834060" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../resources/js/retype.js?v=3.11.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../resources/js/lunr.js?v=3.11.0.813803834060" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../resources/js/prism.js?v=3.11.0.813803834060" defer></script>
</head>
<body>
    <div id="retype-app" class="relative text-base antialiased text-base-text bg-base-bg font-body">
        <div class="absolute bottom-0 left-0" style="top: 5rem; right: 50%"></div>
    
        <header id="retype-header" class="sticky top-0 z-30 flex w-full h-16 bg-header-bg border-b border-header-border md:h-20">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton retype-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="retype-sidebar-left-toggle-button"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="retype-branding-logo" href="../" class="flex items-center leading-snug text-2xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../static/nuclea-logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../static/nuclea-logo.png">
                            </span>
                            <span class="dark:text-white font-bold line-clamp-1 md:line-clamp-2">Covenant</span>
                        </a><span id="retype-branding-label" class="inline-flex mt-1 px-2 py-1 ml-4 text-xs font-medium leading-none items-center rounded-md bg-branding-label-bg text-branding-label-text ring-1 ring-branding-label-border ring-inset md:inline-block">Docs</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block border-base-border"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav id="retype-header-nav" class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://retype.com/guides/getting-started/">Getting Started</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/covenant-org">Repositorios</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-search-placeholder transition-colors duration-200 ease-in bg-search-bg border border-transparent rounded md:text-sm hover:border-search-border-hover focus:outline-none focus:border-search-border-focus" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="retype-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
    
        <div id="retype-container" class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-sidebar-left-bg border-sidebar-left-border sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton">
            
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-filter-bg border border-filter-border rounded shadow-none text-sm focus:outline-none focus:border-filter-border-focus" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-base-border">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-base-border">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-base-border">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://retype.com/guides/getting-started/">Getting Started</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/covenant-org">Repositorios</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 bg-body-bg">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div id="retype-main" class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="retype-markdown" id="retype-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="retype-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="stack-de-self-host" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#stack-de-self-host">#</doc-anchor-trigger>
        <span>Stack de self-host</span>
    </h1>
</doc-anchor-target>
<ul>
<li><a href="https://www.wireguard.com/">wireguard</a>: VPN</li>
<li><a href="https://github.com/fosrl/pangolin">pangolin</a>: Reverse proxy con tuneles</li>
<li><a href="https://github.com/minio/minio">minio</a>: Almacenamiento (como S3 de AWS)</li>
<li><a href="https://beszel.dev/">beszel</a>: Monitoreo</li>
<li><a href="https://canonical.com/lxd">lxd</a> Contenedores para desarrollo</li>
</ul>
<doc-anchor-target id="programas-utiles-para-conexiones-de-red">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#programas-utiles-para-conexiones-de-red">#</doc-anchor-trigger>
        <span>Programas utiles para conexiones de red</span>
    </h2>
</doc-anchor-target>
<ul>
<li>nc (netcat): conexiones con TCP y UDP</li>
<li>iptables: firewall</li>
<li>tcpdump: inspeccionar trafico de redes</li>
</ul>
<doc-anchor-target id="ejemplos-de-comandos">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#ejemplos-de-comandos">#</doc-anchor-trigger>
        <span>Ejemplos de comandos</span>
    </h2>
</doc-anchor-target>
<p>Permitir trafico hacia <code v-pre>puerto</code>, proveniente  de <code v-pre>ip</code>, con protocolo <code v-pre>p</code> (tcp, udp, etc.)</p>
<p><strong>Nota</strong>: Este comando pondra la regla hasta arriba del listado, lo que significa que se procesara antes
que el resto de reglas que se tengan definidas.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">sudo iptables -I INPUT -m $p -p $p -s $ip --dport $puerto -j ACCEPT</code></pre>
</doc-codeblock></div>
<p>Hacer una conexion hacia host con <code v-pre>ip</code> y <code v-pre>puerto</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">nc -zv $ip $puerto</code></pre>
</doc-codeblock></div>
<p>Escuchar por trafico en cierta <code v-pre>interfaz</code> de red hacia cierto <code v-pre>puerto</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">sudo tcpdump -ni $interfaz port $puerto</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="compartir-red-local-a-traves-de-wireguard-distinta-a-la-red-del-wireguard">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#compartir-red-local-a-traves-de-wireguard-distinta-a-la-red-del-wireguard">#</doc-anchor-trigger>
        <span>Compartir red local a traves de wireguard (distinta a la red del wireguard)</span>
    </h2>
</doc-anchor-target>
<ol>
<li>Modificar configuracion de algunos de los peer que tiene acceso a la red que nos interesa compartir
y agregar las siguientes lineas en el apartado de <code v-pre>Interface</code>:</li>
</ol>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">PostUp = iptables -A FORWARD -i interfaz-de-wireguard -j ACCEPT; iptables -t nat -A POSTROUTING -o interfaz-a-compartir -j MASQUERADE
PostDown = iptables -D FORWARD -i interfaz-de-wireguard -j ACCEPT; iptables -t nat -D POSTROUTING -o interfaz-a-compartir -j MASQUERADE</code></pre>
</doc-codeblock></div>
<p>Las interfaces se pueden consultar con <code v-pre>ip addr</code>.</p>
<ol start="2">
<li>Modificar la configuracion del servidor para el peer que publico la nueva red, lo que se tiene que hacer
es agregar la red local al peer o la ip del equipo (para mayor control, sobre lo que se comparte) en
<code v-pre>AllowedIPs</code> seperado por comas, por ejemplo se podria ver:</li>
</ol>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">AllowedIPs = 10.50.44.2/32, 192.168.10.90/24</code></pre>
</doc-codeblock></div>
<p>Recordar reiniciar el servicio con <code v-pre>sudo systemctl restart wg-quick@wg0</code>, modificar el wg0 con la interfaz
correcta.</p>
<ol start="3">
<li>Modificar archivo del peer que quiere tener acceso a esta red y al igual solo agregar la direccion
local del peer que la expuso, por ejemplo:</li>
</ol>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">AllowedIPs = 10.50.44.0/24, 192.168.10.0/24</code></pre>
</doc-codeblock></div>
<p>Recordar reiniciar la conexion de wireguard para que los cambies tomen efecto con
<code v-pre>sudo wg-quick down wg0 &amp;&amp; sudo wg-quick up wg0</code> y cambiar la interfaz por la correcta.</p>
<doc-anchor-target id="ambientes-de-trabajo-virtual-isaacsim--vnc">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#ambientes-de-trabajo-virtual-isaacsim--vnc">#</doc-anchor-trigger>
        <span>Ambientes de trabajo virtual (Isaacsim + VNC)</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="lxc">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#lxc">#</doc-anchor-trigger>
        <span>LXC</span>
    </h3>
</doc-anchor-target>
<p>LXC será nuestra herramienta de contenerización ya que nos permite tener un ambiente muy similar al que tendríamos con una máquina virtual, es decir, por defecto tenemos acceso a un usuario no root, systemd y los paquetes estandar de ubuntu server. Instalarlo es muy sencillo</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo snap install lxd
sudo lxd init</code></pre>
</doc-codeblock></div>
<p>Al instalar le pedirá un tamaño para el sistema de archivos internos, nosotros decidimos utilizar 200GB por instancia, planea acorde</p>
<p>Una guía más afondo para la instalación se puede encontrar <a href="https://canonical.com/lxd/install">aquí</a></p>
<p>Para lanzar la instancia base utilizamos la imagen ubuntu:22.04</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">lxc launch ubuntu:22.04 workstation
lxc config device add workstation gpu gpu</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="lightdm">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#lightdm">#</doc-anchor-trigger>
        <span>Lightdm</span>
    </h3>
</doc-anchor-target>
<p>Este display manager es el encargado de inicializar el servidor de Xorg que utilizará posteriormente VirtualGL para renderizar por hardware el ambiente gráfico</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo apt install lightdm</code></pre>
</doc-codeblock></div>
<div class="flex mb-6">
    <div class="shrink-0 w-1.5 rounded-tl-lg rounded-bl-lg bg-callout-primary"></div>
    <div class="flex w-full py-4 border border-l-0 rounded-tr-lg rounded-br-lg doc-callout bg-callout-base-bg border-callout-base-border" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-callout-primary" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>Si tiene instalado otro display manager es necesario desinstalarlo, por ejemplo</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo apt purge gdm3</code></pre>
</doc-codeblock></div>
        </div>
    </div>
</div>
<doc-anchor-target id="nvidia-drivers">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#nvidia-drivers">#</doc-anchor-trigger>
        <span>Nvidia drivers</span>
    </h3>
</doc-anchor-target>
<p>Si bien, en teoría cualquier drivers de nvidia funcionan, encontramos que los drivers oficiales en su versión <strong>MIT</strong> son los que hacían funcionar a todo el setup</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">wget https://us.download.nvidia.com/XFree86/Linux-x86_64/570.169/NVIDIA-Linux-x86_64-570.169.run  
chmod +x NVIDIA-Linux-x86_64-570.169.run
sudo ./NVIDIA-Linux-x86_64-570.169.run</code></pre>
</doc-codeblock></div>
<div class="flex mb-6">
    <div class="shrink-0 w-1.5 rounded-tl-lg rounded-bl-lg bg-callout-primary"></div>
    <div class="flex w-full py-4 border border-l-0 rounded-tr-lg rounded-br-lg doc-callout bg-callout-base-bg border-callout-base-border" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-callout-primary" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
            <h5>warn</h5>
<p>Tanto el host como el contenedor deberán contar con exactamente la misma versión de drivers para funcionar</p>
        </div>
    </div>
</div>
<doc-anchor-target id="virtual-desktop">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#virtual-desktop">#</doc-anchor-trigger>
        <span>Virtual desktop</span>
    </h3>
</doc-anchor-target>
<p>Para permitir que todo funcione sin que se tenga un display físico conectado, es necesario crear un dispositivo virtual en el contenedor por lo que podemos reemplazar el contenido de <strong>/etc/X11/xorg.conf</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">Section &quot;ServerLayout&quot;
    Identifier     &quot;Layout0&quot;
    Screen      0  &quot;Screen0&quot; 0 0
    InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;
    InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;
EndSection

Section &quot;Module&quot;
    Load           &quot;glx&quot;
EndSection

Section &quot;InputDevice&quot;

    # generated from default
    Identifier     &quot;Keyboard0&quot;
    Driver         &quot;kbd&quot;
EndSection

Section &quot;InputDevice&quot;

    # generated from default
    Identifier     &quot;Mouse0&quot;
    Driver         &quot;mouse&quot;
    Option         &quot;Protocol&quot; &quot;auto&quot;
    Option         &quot;Device&quot; &quot;/dev/mouse&quot;
    Option         &quot;Emulate3Buttons&quot; &quot;no&quot;
    Option         &quot;ZAxisMapping&quot; &quot;4 5&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier     &quot;Monitor0&quot;
    VendorName     &quot;Unknown&quot;
    ModelName      &quot;Unknown&quot;
    Option         &quot;DPMS&quot;
EndSection

Section &quot;Device&quot;
    Identifier     &quot;Device0&quot;
    Driver         &quot;nvidia&quot;
    VendorName     &quot;NVIDIA Corporation&quot;
EndSection</code></pre>
</doc-codeblock></div>
<p>Para mantener consistentes los permisos es necesario reconstruir la configuración de xorg</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo nvidia-xconfig
sudo reboot</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="virtual-gl">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#virtual-gl">#</doc-anchor-trigger>
        <span>Virtual GL</span>
    </h3>
</doc-anchor-target>
<p>Este software permite añadir soporte para renderización por hardare de las llamadas a OpenGL desde la VNC. Para instalarlo es más fácil siendo <strong>sudo</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">wget -q -O- https://packagecloud.io/dcommander/virtualgl/gpgkey | gpg --dearmor &gt;/etc/apt/trusted.gpg.d/VirtualGL.gpg
cd /etc/apt/sources.list.d
wget https://raw.githubusercontent.com/VirtualGL/repo/main/VirtualGL.list
apt update
apt install virtualgl</code></pre>
</doc-codeblock></div>
<p>Una vez instalado es necesario configurarlo para que tenga acceso a las interfaces de la tarjeta gráfica</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo systemctl stop lightdm
sudo /opt/VirtualGL/bin/vglserver_config
sudo systemctl start ligthdm</code></pre>
</doc-codeblock></div>
<p>En nuestro caso no restringimos a los usuarios de utilizar los dispositivos de nvida a pesar de que esto implique peor seguridad ya que estamos dentro de una red privada y en contenedores pero cambie las opciones de acuerdo a sus necesidades</p>
<doc-anchor-target id="turbo-vnc">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#turbo-vnc">#</doc-anchor-trigger>
        <span>Turbo VNC</span>
    </h3>
</doc-anchor-target>
<p>Se eligió este servidor de VNC ya que está diseñado específicamente para funcionar con VirtualGL. Al igual que con VirtualGL, estos pasos deberán seguirse con el usuario sudo</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">wget -q -O- https://packagecloud.io/dcommander/turbovnc/gpgkey | gpg --dearmor &gt;/etc/apt/trusted.gpg.d/TurboVNC.gpg
cd /etc/apt/sources.list.d
wget https://raw.githubusercontent.com/TurboVNC/repo/main/TurboVNC.list
apt update
apt install turbovnc</code></pre>
</doc-codeblock></div>
<p>Puede utilizar cualquier window manager que desee, en nuestro caso utilizamo mate más por gusto que por otra razón</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">sudo apt install mate-desktop-environment</code></pre>
</doc-codeblock></div>
<p>Para facilitar que el vnc siempre se encienda con el contenedor y demás amenidades, creamos el siguiente servicio en <strong><a href="mailto:/etc/systemd/user/turbo-vnc@.service">/etc/systemd/user/turbo-vnc@.service</a></strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">[Unit]
Description=VNC server for hardware acceleration

[Service]
Type=forking
ExecStart=/bin/bash -c &quot;/opt/TurboVNC/bin/vncserver %i -vgl -geometry 1920x1080&quot;
ExecStartPost=/bin/bash -c &quot;DISPLAY=%i xhost +&quot;
ExecStop=/opt/TurboVNC/bin/vncserver -kill %i

[Install]
WantedBy=default.target
ubuntu@covenant-workstation</code></pre>
</doc-codeblock></div>
<p>Para habilitarlo y ejecutarlo utilice el siguiente commando desde el usuario deseado</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">systemctl --user enable turbo-vnc@:1
systemctl --user start turbo-bnc@:1</code></pre>
</doc-codeblock></div>
<p>Para acceder al vnc desde fuera del contenedor y host es necesario crear un proxy desde lxc</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">lxc config device add test proxy-ws proxy listen=tcp:&lt;host public ip&gt;:5901 connect=tcp:&lt;container ip &gt;:5901 bind=host</code></pre>
</doc-codeblock></div>
<p>El cliente de VNC recomendado es remmina o el mismo Turbo VNC</p>
<doc-anchor-target id="isaac-sim">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#isaac-sim">#</doc-anchor-trigger>
        <span>Isaac sim</span>
    </h3>
</doc-anchor-target>
<p>Ya que utilizamos PX4, decidimos utilizar <a href="https://pegasussimulator.github.io/PegasusSimulator/">Pegasus Simulator</a> como bridge de comunicación con el simulador y la versión de isaac compatible es la 4.2</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">mkdir isaac-sim-4.2
cd isaac-sim-4.2
wget https://download.isaacsim.omniverse.nvidia.com/isaac-sim-standalone%404.2.0-rc.18%2Brelease.16044.3b2ed111.gl.linux-x86_64.release.zip
unzip isaac-sim-standalone@4.2.0-rc.18+release.16044.3b2ed111.gl.linux-x86_64.release.zip </code></pre>
</doc-codeblock></div>
<p>No fuimos capaces de hacer funcionar Isaac Sim directamente con nuestro entorno de VNC por lo que decidimos utilizar su función de streaming como medida temporal. Esperamos que con las próximas versiones estos problemas se solucionen o encontremos otra forma de hacer esto</p>
<p>Para descargar el cliente de webrtc de isaac sim ejecute los siguientes comandos</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">wget https://download.isaacsim.omniverse.nvidia.com/isaacsim-webrtc-streaming-client-1.0.6-linux-x64.AppImage
chmod +x isaacsim-webrtc-streaming-client-1.0.6-linux-x64.AppImage</code></pre>
</doc-codeblock></div>
<p>Finalmente para ejecutar el simulador podemos ejecutar</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">./isaac-sim.headless.webrtc.sh</code></pre>
</doc-codeblock></div>
<p>Y en otra terminal ya que se haya terminado de inicializar isaac sim ejecutamos el cliente de webrtc</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-bash"><code v-pre class="language-bash">./isaacsim-webrtc-streaming-client-1.0.6-linux-x64.AppImage --enable-unsafe-switfshader</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="tutorial-para-iniciar-la-simulación">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#tutorial-para-iniciar-la-simulación">#</doc-anchor-trigger>
        <span>Tutorial para iniciar la simulación</span>
    </h3>
</doc-anchor-target>
<p>
<figure>
    <div class="relative w-full mb-6 overflow-hidden pt-9/16">
        <iframe class="w-full h-full border-0 absolute inset-0" src="https://drive.google.com/file/d/1xF0_sIDWwL8dzvwKLmfPKI627ReZcwpK/preview" allowfullscreen></iframe>
    </div>
</figure>
</p>
<doc-anchor-target id="recursos-utiles">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#recursos-utiles">#</doc-anchor-trigger>
        <span>Recursos utiles</span>
    </h2>
</doc-anchor-target>
<ul>
<li><a href="https://linux-audit.com/networking/nftables/nftables-beginners-guide-to-traffic-filtering/">Beginners guide to traffic filtering with nftables</a></li>
<li><a href="https://linux-audit.com/networking/nftables/differences-between-iptables-and-nftables-explained/">Differences between iptables and nftables explained</a></li>
</ul>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer id="retype-content-footer" class="clear-both">
                            
                                <nav id="retype-nextprev" class="print:hidden flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../station/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-base-text-muted">Previous</span>
                                                <span class="block mt-1">Estación de aterrizaje</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../video_summarizer/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-base-text-muted">Next</span>
                                                <span class="block mt-1">Video Summarizaer</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div id="retype-page-footer" class="print:border-none border-t border-base-border pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between print:justify-center">
                                <div id="retype-footer-links" class="print:hidden">
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div id="retype-copyright" class="print:justify-center py-2 text-footer-text font-footer-link-weight text-sm leading-relaxed"><p>© Copyright 2025. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-sidebar-right-bg border-sidebar-right-border lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="retype-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Stack de self-host", level: 1, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
